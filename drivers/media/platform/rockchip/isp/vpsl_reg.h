/* SPDX-License-Identifier: (GPL-2.0+ OR MIT)
 *
 * Copyright (C) 2025 Rockchip Electronics Co., Ltd.
 */

#ifndef _VPSL_REG_H
#define _VPSL_REG_H
#include "dev.h"

#define VPSL_BASE			0x00000000
#define VPSL_CTRL			(VPSL_BASE + 0x00000)
#define VPSL_PYR_CTRL			(VPSL_BASE + 0x00004)
#define VPSL_PYR_CHN			(VPSL_BASE + 0x00008)
#define VPSL_VERSION			(VPSL_BASE + 0x0000C)
#define VPSL_UPDATE			(VPSL_BASE + 0x00010)
#define VPSL_CLK_EN			(VPSL_BASE + 0x00014)
#define VPSL_CLK_GATE			(VPSL_BASE + 0x00018)
#define VPSL_RESET			(VPSL_BASE + 0x0001C)
#define VPSL_PYR_SIGMA_LUT		(VPSL_BASE + 0x00020)
#define VPSL_IRQ_CFG			(VPSL_BASE + 0x00050)
#define VPSL_IMSC			(VPSL_BASE + 0x00070)
#define VPSL_RIS			(VPSL_BASE + 0x00074)
#define VPSL_MIS			(VPSL_BASE + 0x00078)
#define VPSL_ICR			(VPSL_BASE + 0x0007C)
#define VPSL_ISR			(VPSL_BASE + 0x00080)
#define VPSL_PYR_CTRL_SHD		(VPSL_BASE + 0x00094)
#define VPSL_PYR_CHN_SHD		(VPSL_BASE + 0x00098)
#define VPSL_WORKING			(VPSL_BASE + 0x000A0)
#define VPSL_PIPE_ACK0			(VPSL_BASE + 0x000B0)
#define VPSL_PIPE_ACK1			(VPSL_BASE + 0x000B4)
#define VPSL_LINE_CNT0			(VPSL_BASE + 0x000C0)
#define VPSL_LINE_CNT1			(VPSL_BASE + 0x000C4)
#define VPSL_FRAME_CNT			(VPSL_BASE + 0x000C8)
#define VPSL_PYR_FIFO_DBG		(VPSL_BASE + 0x000d0)

#define VPSL_MI_BASE			0x00001000
#define VPSL_MI_CTRL			(VPSL_MI_BASE + 0x00000)
#define VPSL_MI_WR_INIT			(VPSL_MI_BASE + 0x00004)
#define VPSL_MI_HURRY_CTRL		(VPSL_MI_BASE + 0x00040)
#define VPSL_MI_ARQOS_CTRL		(VPSL_MI_BASE + 0x00044)
#define VPSL_MI_IMSC			(VPSL_MI_BASE + 0x00050)
#define VPSL_MI_RIS			(VPSL_MI_BASE + 0x00054)
#define VPSL_MI_MIS			(VPSL_MI_BASE + 0x00058)
#define VPSL_MI_ICR			(VPSL_MI_BASE + 0x0005C)
#define VPSL_MI_ISR			(VPSL_MI_BASE + 0x00060)
#define VPSL_MI_RD_CTRL			(VPSL_MI_BASE + 0x00100)
#define VPSL_MI_RD_INIT			(VPSL_MI_BASE + 0x00104)
#define VPSL_MI_RD_START		(VPSL_MI_BASE + 0x00108)
#define VPSL_MI_RD_Y_BASE		(VPSL_MI_BASE + 0x00110)
#define VPSL_MI_RD_Y_WIDTH		(VPSL_MI_BASE + 0x00114)
#define VPSL_MI_RD_Y_HEIGHT		(VPSL_MI_BASE + 0x00118)
#define VPSL_MI_RD_Y_STRIDE		(VPSL_MI_BASE + 0x0011C)
#define VPSL_MI_RD_Y_BASE_SHD		(VPSL_MI_BASE + 0x00130)
#define VPSL_MI_RD_Y_WIDTH_SHD		(VPSL_MI_BASE + 0x00138)
#define VPSL_MI_RD_Y_HEIGHT_SHD		(VPSL_MI_BASE + 0x0013C)
#define VPSL_MI_CHN0_WR_CTRL		(VPSL_MI_BASE + 0x00200)
#define VPSL_MI_CHN0_WR_BASE		(VPSL_MI_BASE + 0x00210)
#define VPSL_MI_CHN0_WR_SIZE		(VPSL_MI_BASE + 0x00224)
#define VPSL_MI_CHN0_WR_STRIDE		(VPSL_MI_BASE + 0x00228)
#define VPSL_MI_CHN0_WR_BASE_SHD	(VPSL_MI_BASE + 0x00230)
#define VPSL_MI_CHN0_WR_END_ADDR	(VPSL_MI_BASE + 0x00234)
#define VPSL_MI_CHN1_WR_CTRL		(VPSL_MI_BASE + 0x00300)
#define VPSL_MI_CHN1_WR_BASE		(VPSL_MI_BASE + 0x00310)
#define VPSL_MI_CHN1_WR_SIZE		(VPSL_MI_BASE + 0x00324)
#define VPSL_MI_CHN1_WR_STRIDE		(VPSL_MI_BASE + 0x00328)
#define VPSL_MI_CHN1_WR_BASE_SHD	(VPSL_MI_BASE + 0x00330)
#define VPSL_MI_CHN1_WR_END_ADDR	(VPSL_MI_BASE + 0x00334)
#define VPSL_MI_CHN2_WR_CTRL		(VPSL_MI_BASE + 0x00400)
#define VPSL_MI_CHN2_WR_BASE		(VPSL_MI_BASE + 0x00410)
#define VPSL_MI_CHN2_WR_SIZE		(VPSL_MI_BASE + 0x00424)
#define VPSL_MI_CHN2_WR_STRIDE		(VPSL_MI_BASE + 0x00428)
#define VPSL_MI_CHN2_WR_BASE_SHD	(VPSL_MI_BASE + 0x00430)
#define VPSL_MI_CHN2_WR_END_ADDR	(VPSL_MI_BASE + 0x00434)
#define VPSL_MI_CHN3_WR_CTRL		(VPSL_MI_BASE + 0x00500)
#define VPSL_MI_CHN3_WR_BASE		(VPSL_MI_BASE + 0x00510)
#define VPSL_MI_CHN3_WR_SIZE		(VPSL_MI_BASE + 0x00524)
#define VPSL_MI_CHN3_WR_STRIDE		(VPSL_MI_BASE + 0x00528)
#define VPSL_MI_CHN3_WR_BASE_SHD	(VPSL_MI_BASE + 0x00530)
#define VPSL_MI_CHN3_WR_END_ADDR	(VPSL_MI_BASE + 0x00534)
#define VPSL_MI_CHN4_WR_CTRL		(VPSL_MI_BASE + 0x00600)
#define VPSL_MI_CHN4_WR_BASE		(VPSL_MI_BASE + 0x00610)
#define VPSL_MI_CHN4_WR_SIZE		(VPSL_MI_BASE + 0x00624)
#define VPSL_MI_CHN4_WR_STRIDE		(VPSL_MI_BASE + 0x00628)
#define VPSL_MI_CHN4_WR_BASE_SHD	(VPSL_MI_BASE + 0x00630)
#define VPSL_MI_CHN4_WR_END_ADDR	(VPSL_MI_BASE + 0x00634)
#define VPSL_MI_CHN5_WR_CTRL		(VPSL_MI_BASE + 0x00700)
#define VPSL_MI_CHN5_WR_BASE		(VPSL_MI_BASE + 0x00710)
#define VPSL_MI_CHN5_WR_SIZE		(VPSL_MI_BASE + 0x00724)
#define VPSL_MI_CHN5_WR_STRIDE		(VPSL_MI_BASE + 0x00728)
#define VPSL_MI_CHN5_WR_BASE_SHD	(VPSL_MI_BASE + 0x00730)
#define VPSL_MI_CHN5_WR_END_ADDR	(VPSL_MI_BASE + 0x00734)
#define VPSL_MI_CHN6_WR_CTRL		(VPSL_MI_BASE + 0x00800)
#define VPSL_MI_CHN6_WR_BASE		(VPSL_MI_BASE + 0x00810)
#define VPSL_MI_CHN6_WR_SIZE		(VPSL_MI_BASE + 0x00824)
#define VPSL_MI_CHN6_WR_STRIDE		(VPSL_MI_BASE + 0x00828)
#define VPSL_MI_CHN6_WR_BASE_SHD	(VPSL_MI_BASE + 0x00830)
#define VPSL_MI_CHN6_WR_END_ADDR	(VPSL_MI_BASE + 0x00834)
#define VPSL_MI_CHN7_WR_CTRL		(VPSL_MI_BASE + 0x00900)
#define VPSL_MI_CHN7_WR_BASE		(VPSL_MI_BASE + 0x00910)
#define VPSL_MI_CHN7_WR_SIZE		(VPSL_MI_BASE + 0x00924)
#define VPSL_MI_CHN7_WR_STRIDE		(VPSL_MI_BASE + 0x00928)
#define VPSL_MI_CHN7_WR_BASE_SHD	(VPSL_MI_BASE + 0x00930)
#define VPSL_MI_CHN7_WR_END_ADDR	(VPSL_MI_BASE + 0x00934)
#define VPSL_MI_CHN8_WR_CTRL		(VPSL_MI_BASE + 0x00a00)
#define VPSL_MI_CHN8_WR_BASE		(VPSL_MI_BASE + 0x00a10)
#define VPSL_MI_CHN8_WR_SIZE		(VPSL_MI_BASE + 0x00a24)
#define VPSL_MI_CHN8_WR_STRIDE		(VPSL_MI_BASE + 0x00a28)
#define VPSL_MI_CHN8_WR_BASE_SHD	(VPSL_MI_BASE + 0x00a30)
#define VPSL_MI_CHN8_WR_END_ADDR	(VPSL_MI_BASE + 0x00a34)
#define VPSL_MI_CHN9_WR_CTRL		(VPSL_MI_BASE + 0x00b00)
#define VPSL_MI_CHN9_WR_BASE		(VPSL_MI_BASE + 0x00b10)
#define VPSL_MI_CHN9_WR_SIZE		(VPSL_MI_BASE + 0x00b24)
#define VPSL_MI_CHN9_WR_STRIDE		(VPSL_MI_BASE + 0x00b28)
#define VPSL_MI_CHN9_WR_BASE_SHD	(VPSL_MI_BASE + 0x00b30)
#define VPSL_MI_CHN9_WR_END_ADDR	(VPSL_MI_BASE + 0x00b34)
#define VPSL_MI_CHN10_WR_CTRL		(VPSL_MI_BASE + 0x00c00)
#define VPSL_MI_CHN10_WR_BASE		(VPSL_MI_BASE + 0x00c10)
#define VPSL_MI_CHN10_WR_SIZE		(VPSL_MI_BASE + 0x00c24)
#define VPSL_MI_CHN10_WR_STRIDE		(VPSL_MI_BASE + 0x00c28)
#define VPSL_MI_CHN10_WR_BASE_SHD	(VPSL_MI_BASE + 0x00c30)
#define VPSL_MI_CHN10_WR_END_ADDR	(VPSL_MI_BASE + 0x00c34)

#define VPSL_PYR_YRAW_MODE(x)		((x) & 0x3)
#define VPSL_PYR_SIGMA_EN		BIT(2)
#define VPSL_PYR_RAW_MODE		BIT(4)
#define VPSL_PYR_GAIN_LEFTSHIFT(x)	(((x) & 0x7) << 8)
#define VPSL_PYR_BLK_SIG(x)		(((x) & 0xff) << 16)
#define VPSL_PYR_TBL_RD_ONLY		BIT(28)
#define VPSL_PYR_CHN_ADAPT_DIS		BIT(29)
#define VPSL_PYR_ERR_CLR_P		BIT(30)
#define VPSL_PYR_TBL_CLR_P		BIT(31)

#define VPSL_CHN0_EN			BIT(0)
#define VPSL_CHN1_EN			BIT(1)
#define VPSL_CHN2_EN			BIT(2)
#define VPSL_CHN3_EN			BIT(3)
#define VPSL_CHN4_EN			BIT(4)
#define VPSL_CHN5_EN			BIT(5)
#define VPSL_CHN6_EN			BIT(6)
#define VPSL_CHN7_EN			BIT(7)
#define VPSL_CHN8_EN			BIT(8)
#define VPSL_CHN9_EN			BIT(9)
#define VPSL_CHN10_EN			BIT(10)

#define VPSL_CFG_FORCE_UPD		BIT(0)
#define VPSL_CFG_GEN_UPD		BIT(1)
#define VPSL_YRAW_CHN_FORCE_UPD		BIT(4)
#define VPSL_SIGMA_CHN_FORCE_UPD	BIT(5)

#define VPSL_YRAW_CLK_EN		BIT(0)
#define VPSL_SIGMA_CLK_EN		BIT(1)
#define VPSL_MI_CLK_EN			BIT(31)

#define VPSL_YRAW_CKG_DIS		BIT(0)
#define VPSL_SIGMA_CKG_DIS		BIT(1)
#define VPSL_MI_CHN0_CKG_DIS		BIT(16)
#define VPSL_MI_CHN1_CKG_DIS		BIT(17)
#define VPSL_MI_CHN2_CKG_DIS		BIT(18)
#define VPSL_MI_CHN3_CKG_DIS		BIT(19)
#define VPSL_MI_CHN4_CKG_DIS		BIT(20)
#define VPSL_MI_CHN5_CKG_DIS		BIT(21)
#define VPSL_MI_CHN6_CKG_DIS		BIT(22)
#define VPSL_MI_CHN7_CKG_DIS		BIT(23)
#define VPSL_MI_CHN8_CKG_DIS		BIT(24)
#define VPSL_MI_CHN9_CKG_DIS		BIT(25)
#define VPSL_MI_CHN10_CKG_DIS		BIT(26)
#define VPSL_MI_RD_CKG_DIS		BIT(31)

#define VPSL_GLB_SOFT_RST		BIT(0)
#define VPSL_RST_PROTECT_DIS		BIT(30)
#define VPSL_SAFETY_DONE_CLR		BIT(31)

#define VPSL_ISP2VPSL_FRM_ST		BIT(0)
#define VPSL_YRAW_IN_FRM_END		BIT(4)
#define VPSL_YRAW_IN_CFG_IRQ		BIT(5)
#define VPSL_YRAW_FRM_END		BIT(6)
#define VPSL_SIGMA_IN_FRM_END		BIT(8)
#define VPSL_SIGMA_IN_CFG_IRQ		BIT(9)
#define VPSL_SIGMA_FRM_END		BIT(10)
#define VPSL_SIGMA_GAIN_FULL_ERR	BIT(31)

#define VPSL_MI_WR_INIT_BASE_EN		BIT(4)
#define VPSL_MI_WR_INIT_OFFSET_EN	BIT(5)
#define VPSL_MI_WR_FIFO_DIS		BIT(24)
#define VPSL_MI_WR_GLB_EN_DIS		BIT(25)
#define VPSL_MI_WR_ID_POLL_CLR		BIT(26)
#define VPSL_MI_WR_ID_POLL_DIS		BIT(27)

#define VPSL_MI_FORCE_UPD		BIT(0)
#define VPSL_MI_CHN0_SELF_UPD		BIT(4)
#define VPSL_MI_CHN1_SELF_UPD		BIT(5)
#define VPSL_MI_CHN2_SELF_UPD		BIT(6)
#define VPSL_MI_CHN3_SELF_UPD		BIT(7)
#define VPSL_MI_CHN4_SELF_UPD		BIT(8)
#define VPSL_MI_CHN5_SELF_UPD		BIT(9)
#define VPSL_MI_CHN6_SELF_UPD		BIT(10)
#define VPSL_MI_CHN7_SELF_UPD		BIT(11)
#define VPSL_MI_CHN8_SELF_UPD		BIT(12)
#define VPSL_MI_CHN9_SELF_UPD		BIT(13)
#define VPSL_MI_CHN10_SELF_UPD		BIT(14)
#define VPSL_ITSELF_FORCE_PRO_DIS	BIT(31)

#define VPSL_CHN_WR_AUTO_UPD		BIT(1)
#define VPSL_CHN_BURST_LEN(x)		(((x) & 0x3) << 8)
#define VPSL_CHN_WR_EN_SHD		BIT(30)
#define VPSL_CHN_WORKING		BIT(31)

#define VPSL_MI_CHN0_END		BIT(0)
#define VPSL_MI_CHN1_END		BIT(1)
#define VPSL_MI_CHN2_END		BIT(2)
#define VPSL_MI_CHN3_END		BIT(3)
#define VPSL_MI_CHN4_END		BIT(4)
#define VPSL_MI_CHN5_END		BIT(5)
#define VPSL_MI_CHN6_END		BIT(6)
#define VPSL_MI_CHN7_END		BIT(7)
#define VPSL_MI_CHN8_END		BIT(8)
#define VPSL_MI_CHN9_END		BIT(9)
#define VPSL_MI_CHN10_END		BIT(10)
#define VPSL_MI_READ_END		BIT(16)
#define VPSL_BUS_ERR			BIT(28)
#define VPSL_MI_SIGMA_ALL_END		BIT(30)
#define VPSL_MI_YRAW_ALL_END		BIT(31)

#define VPSL_SW_REG_SIZE		0x2000
#define VPSL_SW_MAX_SIZE		(VPSL_SW_REG_SIZE * 2)

static inline void vpsl_write(struct rkisp_device *dev, u32 reg, u32 val, bool is_direct)
{
	void __iomem *base = dev->hw_dev->vpsl_base_addr;
	u32 *mem = dev->sw_vpsl_base_addr + reg;
	u32 *flag = dev->sw_vpsl_base_addr + reg + VPSL_SW_REG_SIZE;

	*mem = val;
	*flag = SW_REG_CACHE;
	if (dev->hw_dev->is_single || is_direct) {
		*flag = SW_REG_CACHE_SYNC;
		writel(val, base + reg);
	}
}

static inline u32 vpsl_read(struct rkisp_device *dev, u32 reg, bool is_direct)
{
	void __iomem *base = dev->hw_dev->vpsl_base_addr;
	u32 val;

	if (dev->hw_dev->is_single || is_direct)
		val = readl(base + reg);
	else
		val = *(u32 *)(dev->sw_vpsl_base_addr + reg);
	return val;
}
#endif
